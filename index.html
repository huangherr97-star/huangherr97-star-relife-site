<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RESET LIFE | 平行时空重塑</title>
    <style>
        :root { --main: #000000; --bg: #f2f2f7; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 40px 20px; margin: 0; }
        .card { background: white; width: 100%; max-width: 500px; padding: 30px; border-radius: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.08); }
        .header { text-align: center; font-weight: 800; font-size: 20px; letter-spacing: 2px; margin-bottom: 30px; }
        h2 { margin: 0 0 10px 0; font-size: 22px; }
        p { color: #666; font-size: 14px; line-height: 1.5; }
        textarea { width: 100%; height: 150px; padding: 15px; border: 1px solid #e5e5ea; border-radius: 16px; font-size: 16px; box-sizing: border-box; margin: 20px 0; outline: none; transition: border 0.3s; }
        textarea:focus { border-color: var(--main); }
        button { width: 100%; padding: 18px; background: var(--main); color: white; border: none; border-radius: 16px; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.1s; }
        button:active { transform: scale(0.98); }
        button:disabled { background: #aeaeb2; cursor: not-allowed; }
        #result { margin-top: 30px; padding: 20px; background: #f9f9f9; border-radius: 16px; display: none; line-height: 1.8; color: #1c1c1e; border: 1px solid #efeff4; }
        .loading { color: #8e8e93; font-style: italic; }
    </style>
</head>
<body>
    <div class="card">
        <div class="header">RESET LIFE</div>
        <h2>重塑你的生命剧本</h2>
        <p>描述一段经历，让时间在这一刻转折</p >
        <textarea id="expInput" placeholder="输入你想要改变的那段经历..."></textarea>
        <button id="mainBtn" onclick="generatePlot()">开始重塑人生</button>
        <div id="result"></div>
    </div>

    <script>
        async function generatePlot() {
            const input = document.getElementById('expInput').value;
            const btn = document.getElementById('mainBtn');
            const resultDiv = document.getElementById('result');

            if (!input.trim()) return alert("请输入您的经历");

            // 进入加载状态
            btn.disabled = true;
            btn.innerText = '正在链接 Edge 节点...';
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<span class="loading">正在通过 Vercel Edge 协议解析时空节点...</span>';

            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ experience: input })
                });

                const data = await response.json();

                if (response.ok) {
                    // 核心修复：这里必须对应后端返回的 data.story
                    const storyContent = data.story || "时空重塑成功，但未返回具体剧情。";
                    resultDiv.innerHTML = '<strong>平行时空结局：</strong><br><br>' + storyContent;
                } else {
                    resultDiv.innerHTML = '解析失败：' + (data.error || '连接超时');
                }
            } catch (err) {
                resultDiv.innerHTML = '连接失败：请检查网络或域名解析状态。';
            } finally {
                btn.disabled = false;
                btn.innerText = '再次重塑人生';
            }
        }
    </script>
</body>
</html>
